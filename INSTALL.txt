- /etc/nixos/respeaker.nix
{ pkgs, ... }: 
let respeaker-record = pkgs.callPackage (builtins.fetchGit {
    url = "https://github.com/Thessal/usb-recording";
    ref = "main";
    rev = "0a874278a1b52abf66f23f3a617d707d62513d43";
  }) {};
in { 
  environment.systemPackages = [ respeaker-record ];
  security.wrappers.respeaker-record = {
    source = "${respeaker-record}/bin/respeaker-record";
    owner = "root";
    group = "root";
    setuid = true;
  };
}


- /etc/nixos/configuration.nix
imports =
[ # Include the results of the hardware scan.
    ./hardware-configuration.nix
    ./respeaker.nix
];


nix-shell -p respeaker-record